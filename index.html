<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Geoportal DGOT Jalisco</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
<link rel="icon" href="data:,">

<!-- === Leaflet y Leaflet.Draw === -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>

<!-- === Supabase === -->
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>

<link rel="stylesheet" href="styles.css">
</head>
<body>

<!-- === MAPA === -->
<div id="map"></div>

<!-- === PANEL PRINCIPAL === -->
<div class="panel" id="panel">
  <!-- 🗂️ MIS REPORTES -->
  <h3 onclick="toggleBox('reportesBox')">Mis reportes</h3>
  <div id="reportesBox" class="hidden">
    <input id="nombre" placeholder="Nombre del solicitante">
    <input id="tipo" placeholder="Tipo de requerimiento">
    <textarea id="comentarios" placeholder="Descripción o comentarios"></textarea>

    <!-- 🔽 Selector de grupo personalizado -->
    <div class="grupo-select-wrapper">
      <div id="grupoSelectBtn" class="grupo-select-btn">Selecciona un grupo ▾</div>
      <div id="grupoDropdown" class="grupo-dropdown hidden"></div>
    </div>

    <div class="draw-buttons">
      <button onclick="startDraw('Point')">📍 Punto</button>
      <button onclick="startDraw('LineString')">〰️ Línea</button>
      <button onclick="startDraw('Polygon')">⬛ Polígono</button>
    </div>

    <button onclick="saveReporte()">💾 Finalizar</button>
  </div>

  <!-- 📋 SEGUIMIENTO DE REPORTES -->
  <h3 onclick="toggleBox('gruposBox')">Seguimiento de reportes</h3>
  <div id="gruposBox" class="hidden">
    <input id="grupoNombre" placeholder="Nuevo grupo o municipio">
    <button onclick="addGrupo()">➕ Crear grupo</button>
    <ul id="listaGrupos"></ul>
  </div>

  <!-- 🗺️ CAPAS -->
  <h3 onclick="toggleBox('capasBox')">Capas</h3>
  <div id="capasBox" class="hidden capas">
    <div class="layer-row">
      <div class="layer-left">
        <input type="checkbox" id="chk_barrios" onchange="toggleLayer('barrios')">
        <span>Barrios</span>
      </div>
      <div class="layer-controls">
        <input type="color" id="col_barrios" value="#59c1b2" onchange="updateLayerStyle('barrios')">
        <input type="range" id="op_barrios" min="0" max="1" step="0.1" value="1" oninput="updateLayerStyle('barrios')">
      </div>
    </div>

    <div class="layer-row">
      <div class="layer-left">
        <input type="checkbox" id="chk_salud" onchange="toggleLayer('salud')">
        <span>Salud</span>
      </div>
      <div class="layer-controls">
        <input type="color" id="col_salud" value="#ed8832" onchange="updateLayerStyle('salud')">
        <input type="range" id="op_salud" min="0" max="1" step="0.1" value="1" oninput="updateLayerStyle('salud')">
      </div>
    </div>
  </div>
</div>

<!-- === BOTÓN DE SALIDA === -->
<button id="logout" onclick="logout()">Cerrar sesión</button>

<!-- === LOGIN === -->
<div id="loginModal" class="active">
  <div id="loginBox">
    <div class="login-tabs">
      <button class="tab-btn active" data-tab="admin">Administrador</button>
      <button class="tab-btn" data-tab="servidores">Servidores Públicos</button>
      <button class="tab-btn" data-tab="publico">Público</button>
    </div>

    <div class="tab-content active" id="tab-admin">
      <h2>🔐 Acceso Geoportal</h2>
      <div class="login-field">
        <input type="password" id="keyPrivacy" placeholder="Key Privacy">
        <button class="eye-btn" id="eyeBtn" onclick="togglePrivacy()">👁</button>
      </div>
      <button onclick="loginAdmin()">Entrar</button>
    </div>

    <div class="tab-content" id="tab-servidores">
      <h2>👷‍♂️ Servidores Públicos</h2>
      <input type="text" id="userServidor" placeholder="Usuario institucional">
      <input type="password" id="passServidor" placeholder="Contraseña">
      <button onclick="loginServidor()">Entrar</button>
    </div>

    <div class="tab-content" id="tab-publico">
      <h2>👥 Público en general</h2>
      <input type="text" id="userPublico" placeholder="Usuario público">
      <input type="password" id="passPublico" placeholder="Contraseña">
      <button onclick="loginPublico()">Entrar</button>
    </div>
  </div>
</div>

<!-- === ARCHIVOS JS === -->
<script src="js/config.js"></script>
<script src="js/map.js"></script>
<script src="js/layers.js"></script>
<script src="js/auth.js"></script>
<script src="js/reports.js"></script>

<!-- === UTILIDADES GLOBALES === -->
<script>
function $(id){ return document.getElementById(id); }
function toggleBox(id){
  const el = $(id);
  if (el) el.classList.toggle("hidden");
}
</script>


<!-- === LOADER ANIMADO === -->
<div id="loaderOverlay" class="loader-overlay hidden">
  <div class="loader-circle"></div>
  <div class="loader-text">Cargando Geoportal DGOT...</div>
</div>

</body>
</html>
